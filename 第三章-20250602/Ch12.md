# Ch12 SQL数据定义

## 层次化的数据库对象命名机制
- 一个关系数据库管理系统的实例中可以建立多个数据库
- 一个数据库中可以建立多个模式
- 一个模式下通常包括多个表， 视图和索引等数据库对象

SQL的数据定义功能
- 模式定义
- 表定义
- 视图和索引定义


## 定义模式
定义模式实际上定义了一个命名空间
- 在这个空间中可以定义该模式包含的数据库对象，如基本表, 视图, 索引等

```SQL
CREATE SCHEMA <模式名> AUTHORIZATION<用户名> [<表定义子句> | <视图定义子句> | <授权定义子句> ]
```

*中括号内为选填内容*

语句可以不指定模式名, 模式名隐含为用户名
```SQL
CREATE SCHEMA AUTHORIZATION WANG;
```

### 删除模式
```SQL
DROP SCHEMA <模式名> <CASCADE|RESTRICT>
```

- CASCADE(级联): 删除模式的同时把该模式中所有的数据库对象全部删除
- RESTRICT(限制): 如果该模式中定义了下属的数据库对象, 则拒绝该删除语句的执行, 仅当该模式中没有任何下属的对象时才能删除成功

## 定义基本表
```SQL
CREATE TABLE <表名> 
(<列名> <数据类型> [<列级完整性约束条件>],
 <列名> <数据类型> [<列级完整性约束条件>],
 ...
 [<表级完整性约束条件>]);
```
这里的完整性约束条件一般是用户定义的完整性, 因为其他实体完整性和参照完整性由DBMS实现

如果完整性约束条件涉及一个属性, 那么既可以定义在列级也可以定义在表级; 如果设计多个属性列, 则只能定义在表级

常见的约束有
- PRIMARY KEY: 指明该属性是主码 **实体完整性**
- UNIQUE: 表示该属性不可重复
- NOT NULL: 该属性不可取空值
- FOREIGN KEY (Cpno) REFERENCES Course(Cno): 表示Cpno是外键, 被参照表是Course, 被参照属性是Cno **必须定义在表级完整性约束**

### 修改基本表
```SQL
ALTER TABLE <表名>
[ADD [COLUMN] <新列名> <数据类型> [完整性约束]]
[ADD <表级完整性约束>]
[DROP [COLUMN] <列名> [CASCADE|RESTRICT]]
[DROP CONSTRAINT <完整性约束名> [RESTRICT|CASCADE]]
[ALTER COLUMN <列名> <数据类型>]
```

### 删除基本表
```SQL
DROP TABLE <表名> [RESTRICT|CASCADE]
```

## 数据类型
SQL中域的概念用**数据类型**来实现

定义表的属性时需要指明其数据类型及长度


## 索引
为什么要建立索引: 加快查询速度
- 由数据库管理员或表的拥有者建立
- 由关系数据库管理系统自动完成维护
- 关系数据库管理系统自动使用合适的索引作为存储路径, 用户不必也不能显式地选择索引

```SQL
CREATE [UNIQUE] [CLUSTER] INDEX <索引名> ON <表名> (<列名> [<次序>] [,<列名> [<次序>]] ...);
```

- 索引可以建立在该表的一列或多列上, 各列名之间用逗号分割
- 次序: 制定索引值的排列次序, ASC(升序), DESC(降序), 默认ASC
- UNIQUE: 此索引的每一个索引值只对应唯一的数据记录
- CLUSTER: 表示要建立的索引是聚簇索引

### 修改索引
```SQL
ALTER INDEX <旧索引名> RENAME TO <新索引名>
```

不能直接在原有索引上进行修改, 若要修改索引要创建一个新索引然后进行重命名

修改索引的唯一方式就是重建一个索引


### 删除索引
```SQL
DROP INDEX <索引名>
```

删除索引时, 系统会自动从数据字典中删去有关该索引的描述

注意: 建立在表上的索引也会导致RESTRICT删除表失败

## 数据字典
是关系数据库管理系统内部的一组系统表, 记录了数据库中所有定义信息
- 关系模式定义
- 视图定义
- 索引定义
- 完整性约束定义
- 各类用户对数据库的操作权限
- 统计信息等

关系数据库管理系统在执行SQL的数据定义语句时, 实际上就是在更新数据字典表中的相应信息