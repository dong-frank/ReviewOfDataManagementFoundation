# Ch22 视图
视图的特点
- 虚表, 是从基本表(或视图)导出的表
- 只存放视图的定义, 不存放视图对应的数据
- 基本表中的数据发生改变, 视图查询出的数据也随之改变

## 定义视图
```SQL
CREATE VIEW <视图名> [(<列名> [,<列名>]...)] AS <子查询> [WITH CHECK OPTION];
```

- WITH CHECK OPTION: 对视图进行UPDATE, INSERT 和DELETE时要保证更新,插入,删除的行满足视图定义中的谓词条件(即子查询中的条件表达式)
- 子查询可以是任意的SELECT语句

组成视图的属性列名
- 全部省略: 由子查询中SELECT目标列组成
- 全部指定
  - 可以指定某个目标列是聚集函数或列表达式
  - 多表连接时选出同名列作为视图字段需要改为更合适的名称
- 但不管省略还是指定, 视图中的属性列是和SELECT目标列一一对应的

关系数据库管理系统执行建立视图时系统只是把视图定义存入数据字典, 并不会执行SELECT语句

当需要对视图查询时, 系统按视图的定义从基本表中将数据查出

若一个视图是从单个基本表导出的, 且只是去掉了基本表的某些行和列, 但保留了主码, 我们称这类视图为**行列子集视图**


## 删除视图
```SQL
DROP VIEW <视图名>[CASCADE];
```
- 该语句从数据字典中删除指定的视图定义
- 如果该视图上还导出了其他视图, 使用CASCADE级联删除
- 删除基本表时, 由该基本表导出的所有视图定义都必须显式地使用DROP VIEW删除, 也可以在删除基本表时选择CASCADE

## 查询视图
从用户角度, 查询视图与查询基本表相同, **视图就是为了外模式而使用**

关系数据库管理系统实现视图查询的方法
- 视图消解法
  - 进行有效性检查
  - 转换成等价的对基本表的查询
  - 执行修正后的查询

## 更新视图
若用户有足够的权限进行视图更新, 就是相当于更新基本表

允许对行列子集视图进行更新, 但也有一些视图是不可更新的, 因为对这些视图的更新不能唯一地有意义地转换成相应基本表的更新


## 视图的作用
1. 当视图中数据不是直接来自基本表时, 定义视图可以简化用户的操作, *基于多张表连接的视图, 基于复杂嵌套查询的视图, 含导出属性的视图*
2. 视图机制能使不同用户以不同方式看待同一数据. 适应数据库共享的需要 **数据库系统的外模式**
3. 视图对重构数据库提供了一定的逻辑独立性, 通过建立一个视图使数据库模式变更的时候用户的外模式保持不变
4. 视图能够对机密数据提供安全保护, 对不同用户定义不同视图, 每个用户只能看到他有权看到的数据
5. 适当的利用视图可以更清晰的表达查询