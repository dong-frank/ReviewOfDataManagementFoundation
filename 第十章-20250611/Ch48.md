# Ch48 事务

事务是用户定义的一个数据库操作序列, 这些操作要么全做, 要么全不做

事务和程序是两个概念

事务是恢复和并发控制的基本单位

## 定义事务
```SQL
BEGIN TRANSACTION
    SQL 语句1
    SQL 语句2
    ...

COMMIT / ROLLBACK
```

COMMIT表示事务正常结束, 提交事务的所有操作, 所有对数据库的更新写回到磁盘上

ROLLBACK表示事务异常终止, 所有已完成的操作全部撤销, 事务回滚到开始状态

若不显示定义, 则数据库管理系统会默认划分事务

## 事务的特性ACID
- 原子性: 事务是数据库的逻辑工作单位
- 一致性
- 隔离性
- 持续性

保证事务ACID特性是事务处理的任务
### 一致性
事务执行的结果必须使数据库从一个一致性状态变到另一个一致性状态
- 一致性状态: 数据库中只包含成功事务提交的结果
- 不一致性状态: 数据库系统运行中发生故障, 有些事物尚未完成就被迫中断, 这些未完成事务的修改有一部分已写入物理数据库, 这时数据库处于不正确的状态

### 隔离性
- 一个事务的执行不能被其他事务干扰
- 一个事务内部及使用的数据对其他并发事务是隔离的
- 并发执行的各个事务之间不能互相干扰

### 持续性
也称为永久性
- 一个事务一旦提交, 对数据库中数据的改变就应该是永久性的


