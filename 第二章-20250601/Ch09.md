# Ch09关系的完整性
关系的完整性约束有三类
1. 实体完整性
2. 参照完整性
3. 用户定义的完整性

其中实体完整性和参照完整性是关系模型必须满足的完整性约束条件, 称为关系的两个不变性, 是由系统自动支持

用户定义的完整性和相关的应用领域有关, 体现了具体领域中的语义约束

## 实体完整性规则
- 若属性A是基本关系R的主属性, 则属性A不能为空

*基本关系: 实际存在的表, 是实际存储数据的逻辑表示*

*主属性: 候选码中的属性*

现实世界的实体是可区分的, 如果主属性为空, 则说明存在某个不可标识的实体, 这是矛盾的

## 关系间的引用
在关系模型中实体及实体间的联系都是用关系来描述的, 自然存在着关系与关系间的引用

**注意区别联系和关系**
*例: 学生实体, 和专业实体, 之间存在着专业和学生一对多的联系, 学生关系引用了专业关系的主码"专业号"*
*例: 学生实体及内部的领导联系, 学生关系引用了自身的主码"学号"(班长的学号)*

### 外码(foreign key)
也称为外键定义如下:

设F是基本关系R的一个或一组属性(*统一理解为属性集合*), 但不是关系R的码. 如果F与基本关系S的主码$K_S$相对应, 则称F是R的外码
- 基本关系R称为参照关系(referencing relation)
- 基本关系S称为被参照关系(referenced relation) 或目标关系(target relation)
- 关系R和S不一定是不同的关系 *因为存在自身到自身的联系*
- 目标关系的主码和参照关系的外码必须定义在用样的域上
- 外码不一定要与相应的主码同名 *学生内部的领导联系, 通常班长的学号的属性名为班长, 虽然他的主码是学号*

$学生关系 \stackrel{专业号}{\longrightarrow} 专业关系$

由参照关系指向目标关系, 可以理解为从参照关系根据外码到目标关系中找出对应的实体


## 参照完整性规则
- 对于基本关系R, 若F是外码, 那么R中每个元组在F上的取值必须为空或者是目标关系中某个元组的主码

即要么没有参照, 有参照就必须要是存在的实体


## 用户定义的完整性
- 针对某一具体关系数据库的约束条件, 反映某一具体应用所涉及的数据必须满足的语义要求
- 关系模型应提供定义和检验这类完整性的机制, 而不需由应用程序承担